<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>רדיו</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f2f3f7; }
    h1 { text-align: center; }
    details {
            width: 100%;
            margin: 8px auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            overflow: hidden;
        }
    summary {
      cursor: pointer;
      padding: 25px 14px;
      border-bottom: 1px solid #ddd;
      user-select: none;
      width: 100%;
      box-sizing: border-box;
      font-weight: bold;
      font-size: 1.5em;
      background: rgb(227, 237, 247);
      transition: background 0.2s;
      text-align: right;
    }
    summary:hover {
        background: #f0f0f0;
    }
    .stations { display: flex; flex-wrap: wrap; gap: 10px; padding: 10px; }
    .station { width: 80px; text-align: center; cursor: pointer; }
    .station img { width: 64px; height: 64px; object-fit: contain; border: 1px solid #ddd; border-radius: 6px; background: #fafafa; }
    .station span { display: block; font-size: 12px; margin-top: 4px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .loading { padding: 10px; color: #444; }
  </style>
</head>
<body>
  <h1>רדיו</h1>
  <div id="countries"></div>

  <script>
    const apiBase = "https://de1.api.radio-browser.info/json";
    const countriesDiv = document.getElementById("countries");

    async function loadCountries() {
      const res = await fetch(apiBase + "/countries");
      const countries = await res.json();

      countries.forEach(country => {
        const details = document.createElement("details");
        const summary = document.createElement("summary");
        summary.textContent = `${country.name} (${country.stationcount} תחנות)`;
        details.appendChild(summary);

        const content = document.createElement("div");
        content.className = "loading";
        content.textContent = "פתח כדי לטעון תחנות...";
        details.appendChild(content);

        // טעינת תחנות רק כשפותחים
        details.addEventListener("toggle", async () => {
          if (details.open && content.className === "loading") {
            content.textContent = "טוען תחנות...";
            try {
              const stationsRes = await fetch(apiBase + "/stations/bycountry/" + encodeURIComponent(country.name));
              const stations = await stationsRes.json();

              content.innerHTML = "";
              content.className = "stations";
              stations.forEach(st => {
                const div = document.createElement("div");
                div.className = "station";
                div.innerHTML = `
                  <img src="${st.favicon || 'https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg'}" alt="${st.name}">
                  <span>${st.name}</span>
                `;
                div.addEventListener("click", () => {
                  const playerUrl = `radio_player.html?url=${encodeURIComponent(st.url_resolved || st.url)}&name=${encodeURIComponent(st.name)}&logo=${encodeURIComponent(st.favicon || '')}`;
                  window.open(playerUrl, "_blank");
                });
                content.appendChild(div);
              });

              if (stations.length === 0) {
                content.textContent = "אין תחנות זמינות למדינה זו.";
              }
            } catch (err) {
              console.error(err);
              content.textContent = "שגיאה בטעינת תחנות.";
            }
          }
        });

        countriesDiv.appendChild(details);
      });
    }

    loadCountries();
  </script>
</body>
</html>
