<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8">
<title>ספריית מוזיקה</title>
<style>
  body { font-family: Arial; margin: 20px; }
  input { padding: 10px; width: 300px; }
  button { padding: 10px; }
  .track { margin: 10px 0; }
</style>
</head>
<body>

<h1>ספריית מוזיקה - Spotify</h1>
<button id="loginBtn">התחבר לספוטיפיי</button>

<div id="searchSection" style="display:none;">
  <input type="text" id="search" placeholder="חפש שיר או אמן">
  <button onclick="search()">חפש</button>
  <div id="results"></div>
</div>

<script>
// ⚠️ החלף ב-Client ID שלך:
const clientId = 'c3bdf7360223477e9255707b422b3ccc';
const redirectUri = window.location.href.split('#')[0]; // דף זה
let accessToken = null;

// בדיקה אם יש טוקן ב-URL
window.onload = () => {
  const hash = window.location.hash;
  if (hash) {
    const params = new URLSearchParams(hash.substring(1));
    accessToken = params.get('access_token');
    if (accessToken) {
      document.getElementById('loginBtn').style.display = 'none';
      document.getElementById('searchSection').style.display = 'block';
    }
  }
};

// התחברות לספוטיפיי
document.getElementById('loginBtn').onclick = () => {
  const scopes = 'user-read-private';
  const url = `https://accounts.spotify.com/authorize?client_id=${clientId}&response_type=token&redirect_uri=${encodeURIComponent(redirectUri)}&scope=${scopes}`;
  window.location = url;
};

// חיפוש שירים
async function search() {
  const query = document.getElementById('search').value;
  const url = `https://api.spotify.com/v1/search?q=${encodeURIComponent(query)}&type=track&limit=10`;
  
  const res = await fetch(url, {
    headers: { Authorization: `Bearer ${accessToken}` }
  });
  
  const data = await res.json();
  const resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML = '';

  data.tracks.items.forEach(track => {
    const div = document.createElement('div');
    div.className = 'track';
    div.innerHTML = `
      <p>${track.name} - ${track.artists.map(a => a.name).join(', ')}</p>
      <iframe src="https://open.spotify.com/embed/track/${track.id}" 
              width="300" height="80" frameborder="0" allow="autoplay; encrypted-media"></iframe>
    `;
    resultsDiv.appendChild(div);
  });
}
</script>

</body>
</html>